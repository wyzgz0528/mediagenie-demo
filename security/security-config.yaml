# MediaGenie Security Configuration
# 安全和合规配置文件

security:
  # 数据加密
  encryption:
    # 传输加密
    tls:
      enabled: true
      min_version: "1.2"
      cipher_suites:
        - "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
        - "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
        - "TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305"
    
    # 静态数据加密
    at_rest:
      enabled: true
      algorithm: "AES-256-GCM"
      key_rotation_days: 90
      
    # 数据库加密
    database:
      enabled: true
      transparent_data_encryption: true
      column_encryption: true
      backup_encryption: true

  # 身份验证和授权
  authentication:
    # Azure AD B2C配置
    azure_ad_b2c:
      enabled: true
      tenant_name: "${AZURE_AD_B2C_TENANT_NAME}"
      client_id: "${AZURE_AD_B2C_CLIENT_ID}"
      policy_name: "B2C_1_signupsignin"
      
    # JWT配置
    jwt:
      algorithm: "RS256"  # 使用RSA签名
      access_token_expiry: 3600  # 1小时
      refresh_token_expiry: 2592000  # 30天
      issuer: "https://mediagenie.azurewebsites.net"
      
    # 多因素认证
    mfa:
      enabled: true
      methods: ["sms", "email", "authenticator"]
      required_for_admin: true

  # 访问控制
  authorization:
    # 基于角色的访问控制
    rbac:
      enabled: true
      roles:
        - name: "user"
          permissions: ["read", "create_task", "view_own_data"]
        - name: "premium_user"
          permissions: ["read", "create_task", "view_own_data", "api_access", "advanced_features"]
        - name: "admin"
          permissions: ["*"]
          
    # API访问限制
    api_limits:
      rate_limiting:
        enabled: true
        requests_per_minute: 100
        requests_per_hour: 1000
        burst_limit: 20
      
      # IP白名单（可选）
      ip_whitelist:
        enabled: false
        allowed_ips: []

  # 数据保护
  data_protection:
    # GDPR合规
    gdpr:
      enabled: true
      data_retention_days: 2555  # 7年
      right_to_be_forgotten: true
      data_portability: true
      consent_management: true
      
    # 数据分类
    classification:
      levels:
        - "public"
        - "internal"
        - "confidential"
        - "restricted"
      
    # 数据丢失防护
    dlp:
      enabled: true
      scan_uploads: true
      block_sensitive_data: true
      
    # 数据备份
    backup:
      enabled: true
      frequency: "daily"
      retention_days: 90
      encryption: true
      geographic_replication: true

  # 网络安全
  network:
    # Web应用防火墙
    waf:
      enabled: true
      mode: "prevention"
      rule_sets:
        - "OWASP_3.2"
        - "Microsoft_BotManagerRuleSet_1.0"
        
    # DDoS防护
    ddos_protection:
      enabled: true
      threshold_pps: 100000
      
    # 网络隔离
    network_isolation:
      enabled: true
      vnet_integration: true
      private_endpoints: true

  # 应用安全
  application:
    # 输入验证
    input_validation:
      enabled: true
      max_file_size: "100MB"
      allowed_file_types: [".mp3", ".wav", ".m4a", ".jpg", ".png", ".pdf", ".txt"]
      sanitize_inputs: true
      
    # 输出编码
    output_encoding:
      enabled: true
      html_encoding: true
      json_encoding: true
      
    # 安全头
    security_headers:
      enabled: true
      headers:
        - "X-Content-Type-Options: nosniff"
        - "X-Frame-Options: DENY"
        - "X-XSS-Protection: 1; mode=block"
        - "Strict-Transport-Security: max-age=31536000; includeSubDomains"
        - "Content-Security-Policy: default-src 'self'"

  # 审计和监控
  monitoring:
    # 安全事件日志
    security_logging:
      enabled: true
      log_level: "INFO"
      events:
        - "authentication_attempts"
        - "authorization_failures"
        - "data_access"
        - "configuration_changes"
        - "suspicious_activities"
        
    # 实时监控
    real_time_monitoring:
      enabled: true
      alert_thresholds:
        failed_logins: 5
        unusual_data_access: 10
        api_abuse: 100
        
    # SIEM集成
    siem_integration:
      enabled: true
      provider: "Azure Sentinel"
      
    # 威胁检测
    threat_detection:
      enabled: true
      machine_learning: true
      behavioral_analysis: true

  # 合规性
  compliance:
    # 标准合规
    standards:
      - "SOC 2 Type II"
      - "ISO 27001"
      - "GDPR"
      - "CCPA"
      - "HIPAA"  # 如果处理健康数据
      
    # 审计
    auditing:
      enabled: true
      frequency: "quarterly"
      external_auditor: true
      
    # 政策管理
    policy_management:
      enabled: true
      policy_review_frequency: "annually"
      policy_approval_workflow: true

  # 事件响应
  incident_response:
    # 自动响应
    automated_response:
      enabled: true
      actions:
        - "block_suspicious_ip"
        - "disable_compromised_account"
        - "alert_security_team"
        
    # 事件分类
    incident_classification:
      levels:
        - "low"
        - "medium"
        - "high"
        - "critical"
        
    # 通知配置
    notifications:
      enabled: true
      channels: ["email", "sms", "teams"]
      escalation_rules: true

  # 漏洞管理
  vulnerability_management:
    # 定期扫描
    scanning:
      enabled: true
      frequency: "weekly"
      tools: ["Azure Security Center", "OWASP ZAP"]
      
    # 补丁管理
    patch_management:
      enabled: true
      auto_update: true
      maintenance_window: "Sunday 02:00-04:00 UTC"
      
    # 渗透测试
    penetration_testing:
      enabled: true
      frequency: "quarterly"
      external_testing: true

# 环境特定配置
environments:
  development:
    security:
      authentication:
        jwt:
          access_token_expiry: 86400  # 24小时，便于开发
      monitoring:
        security_logging:
          log_level: "DEBUG"
          
  staging:
    security:
      # 与生产环境相同的安全配置
      
  production:
    security:
      # 最严格的安全配置
      authentication:
        mfa:
          required_for_all: true
      monitoring:
        real_time_monitoring:
          alert_thresholds:
            failed_logins: 3  # 更严格的阈值
