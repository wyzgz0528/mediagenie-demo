{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [
      {
        "name": "appNamePrefix",
        "type": "Microsoft.Common.TextBox",
        "label": "应用名称前缀",
        "defaultValue": "mediagenie",
        "toolTip": "用于生成所有资源名称的前缀",
        "constraints": {
          "required": true,
          "regex": "^[a-z0-9]{3,15}$",
          "validationMessage": "应用名称前缀必须是3-15个字符，只能包含小写字母和数字"
        }
      }
    ],
    "steps": [
      {
        "name": "appServiceConfig",
        "label": "App Service 配置",
        "elements": [
          {
            "name": "appServicePlanSku",
            "type": "Microsoft.Common.DropDown",
            "label": "App Service Plan SKU",
            "defaultValue": "B1 - Basic",
            "toolTip": "选择 App Service Plan 的定价层",
            "constraints": {
              "allowedValues": [
                {
                  "label": "F1 - Free",
                  "value": "F1"
                },
                {
                  "label": "B1 - Basic",
                  "value": "B1"
                },
                {
                  "label": "B2 - Basic",
                  "value": "B2"
                },
                {
                  "label": "S1 - Standard",
                  "value": "S1"
                },
                {
                  "label": "S2 - Standard",
                  "value": "S2"
                }
              ],
              "required": true
            }
          }
        ]
      },
      {
        "name": "azureServices",
        "label": "Azure AI 服务配置",
        "elements": [
          {
            "name": "azureOpenAISection",
            "type": "Microsoft.Common.Section",
            "label": "Azure OpenAI 配置",
            "elements": [
              {
                "name": "azureOpenAIEndpoint",
                "type": "Microsoft.Common.TextBox",
                "label": "Azure OpenAI Endpoint",
                "defaultValue": "",
                "toolTip": "Azure OpenAI 服务的终结点 URL",
                "placeholder": "https://your-resource.openai.azure.com/",
                "constraints": {
                  "required": false,
                  "regex": "^$|^https://.*\\.openai\\.azure\\.com/?$",
                  "validationMessage": "请输入有效的 Azure OpenAI Endpoint"
                }
              },
              {
                "name": "azureOpenAIKey",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "Azure OpenAI API Key",
                  "confirmPassword": "确认 API Key"
                },
                "toolTip": "Azure OpenAI 服务的 API 密钥",
                "constraints": {
                  "required": false
                },
                "options": {
                  "hideConfirmation": true
                }
              }
            ]
          },
          {
            "name": "azureSpeechSection",
            "type": "Microsoft.Common.Section",
            "label": "Azure Speech 配置",
            "elements": [
              {
                "name": "azureSpeechKey",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "Azure Speech Service Key",
                  "confirmPassword": "确认 Service Key"
                },
                "toolTip": "Azure Speech 服务的密钥",
                "constraints": {
                  "required": false
                },
                "options": {
                  "hideConfirmation": true
                }
              },
              {
                "name": "azureSpeechRegion",
                "type": "Microsoft.Common.TextBox",
                "label": "Azure Speech Region",
                "defaultValue": "eastus",
                "toolTip": "Azure Speech 服务的区域",
                "constraints": {
                  "required": false
                }
              }
            ]
          },
          {
            "name": "azureVisionSection",
            "type": "Microsoft.Common.Section",
            "label": "Azure Computer Vision 配置",
            "elements": [
              {
                "name": "azureComputerVisionEndpoint",
                "type": "Microsoft.Common.TextBox",
                "label": "Azure Computer Vision Endpoint",
                "defaultValue": "",
                "toolTip": "Azure Computer Vision 服务的终结点 URL",
                "placeholder": "https://your-resource.cognitiveservices.azure.com/",
                "constraints": {
                  "required": false,
                  "regex": "^$|^https://.*\\.cognitiveservices\\.azure\\.com/?$",
                  "validationMessage": "请输入有效的 Azure Computer Vision Endpoint"
                }
              },
              {
                "name": "azureComputerVisionKey",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "Azure Computer Vision Key",
                  "confirmPassword": "确认 Key"
                },
                "toolTip": "Azure Computer Vision 服务的密钥",
                "constraints": {
                  "required": false
                },
                "options": {
                  "hideConfirmation": true
                }
              }
            ]
          },
          {
            "name": "infoBox",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "Azure AI 服务配置为可选项。如果不配置，部分功能将无法使用。您可以在部署后通过 App Service 的应用程序设置进行配置。"
            }
          }
        ]
      }
    ],
    "outputs": {
      "location": "[location()]",
      "appNamePrefix": "[basics('appNamePrefix')]",
      "appServicePlanSku": "[steps('appServiceConfig').appServicePlanSku]",
      "azureOpenAIEndpoint": "[steps('azureServices').azureOpenAISection.azureOpenAIEndpoint]",
      "azureOpenAIKey": "[steps('azureServices').azureOpenAISection.azureOpenAIKey]",
      "azureSpeechKey": "[steps('azureServices').azureSpeechSection.azureSpeechKey]",
      "azureSpeechRegion": "[steps('azureServices').azureSpeechSection.azureSpeechRegion]",
      "azureComputerVisionEndpoint": "[steps('azureServices').azureVisionSection.azureComputerVisionEndpoint]",
      "azureComputerVisionKey": "[steps('azureServices').azureVisionSection.azureComputerVisionKey]"
    }
  }
}
