# ğŸ§ª ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å?
> **ç›®æ ‡**: æµ‹è¯•å®Œæ•´çš„è®¢é˜…æ¿€æ´»æµç¨‹å’Œ Webhook å¤„ç†  
> **é¢„è®¡æ—¶é—´**: 1 å°æ—¶

---

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤?
### 1ï¸âƒ£ å¯åŠ¨æ‰€æœ‰æœåŠ?
**ç»ˆç«¯ 1: å¯åŠ¨åç«¯æœåŠ¡**
```bash
cd backend/media-service
python -m uvicorn main:app --host 0.0.0.0 --port 9001 --reload
```

**ç»ˆç«¯ 2: å¯åŠ¨ Marketplace Portal**
```bash
cd marketplace-portal
python app.py
```

**ç»ˆç«¯ 3: å¯åŠ¨å‰ç«¯åº”ç”¨**
```bash
cd frontend
npm start
```

### 2ï¸âƒ£ éªŒè¯æ‰€æœ‰æœåŠ¡éƒ½å·²å¯åŠ?
- âœ?åç«¯æœåŠ¡: `http://localhost:9001/docs`
- âœ?Marketplace Portal: `http://localhost:5000`
- âœ?å‰ç«¯åº”ç”¨: `http://localhost:3000`

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: å¥åº·æ£€æŸ?
**ç›®æ ‡**: éªŒè¯æ‰€æœ‰æœåŠ¡éƒ½æ­£å¸¸è¿è¡Œ

**æ­¥éª¤**:
1. æ‰“å¼€æµè§ˆå™¨è®¿é—?`http://localhost:9001/health`
2. éªŒè¯è¿”å› 200 OK
3. æŸ¥çœ‹å“åº”æ•°æ®

**é¢„æœŸç»“æœ**:
```json
{
  "status": "active",
  "service": "MediaGenie",
  "version": "1.0.0",
  "timestamp": "2025-10-27T..."
}
```

---

### åœºæ™¯ 2: Marketplace å¥åº·æ£€æŸ?
**ç›®æ ‡**: éªŒè¯ Marketplace é›†æˆæ­£å¸¸

**æ­¥éª¤**:
1. æ‰“å¼€æµè§ˆå™¨è®¿é—?`http://localhost:9001/marketplace/health`
2. éªŒè¯è¿”å› 200 OK
3. æŸ¥çœ‹ Marketplace ç«¯ç‚¹ä¿¡æ¯

**é¢„æœŸç»“æœ**:
```json
{
  "status": "active",
  "marketplace": {
    "webhook_endpoint": "/api/marketplace/webhook",
    "supported_actions": ["subscribe", "unsubscribe", "changePlan", "changeQuantity"]
  }
}
```

---

### åœºæ™¯ 3: å‘é€?Webhook äº‹ä»¶

**ç›®æ ‡**: æµ‹è¯• Webhook å¤„ç†å’Œæ•°æ®åº“å­˜å‚¨

**æ­¥éª¤**:
1. æ‰“å¼€ Swagger UI: `http://localhost:9001/docs`
2. æ‰¾åˆ° `POST /marketplace/webhook` ç«¯ç‚¹
3. ç‚¹å‡» "Try it out"
4. è¾“å…¥ä»¥ä¸‹æ•°æ®:

```json
{
  "id": "webhook-test-001",
  "activityId": "activity-001",
  "subscriptionId": "sub-test-001",
  "offerId": "offer-test",
  "publisherId": "publisher-test",
  "planId": "basic",
  "quantity": 1,
  "timeStamp": "2025-10-27T10:00:00Z",
  "action": "Subscribe",
  "status": "Success"
}
```

5. ç‚¹å‡» "Execute"
6. éªŒè¯è¿”å› 200 æˆ?201

**é¢„æœŸç»“æœ**:
```json
{
  "status": "received",
  "event_id": "webhook-test-001",
  "message": "Webhook event received and queued for processing"
}
```

---

### åœºæ™¯ 4: æŸ¥è¯¢äº‹ä»¶åˆ—è¡¨

**ç›®æ ‡**: éªŒè¯äº‹ä»¶å·²ä¿å­˜åˆ°æ•°æ®åº?
**æ­¥éª¤**:
1. æ‰“å¼€ Swagger UI: `http://localhost:9001/docs`
2. æ‰¾åˆ° `GET /marketplace/events` ç«¯ç‚¹
3. ç‚¹å‡» "Try it out"
4. ç‚¹å‡» "Execute"
5. éªŒè¯è¿”å› 200 OK
6. æŸ¥çœ‹äº‹ä»¶åˆ—è¡¨ä¸­æ˜¯å¦åŒ…å«ä¹‹å‰å‘é€çš„äº‹ä»¶

**é¢„æœŸç»“æœ**:
```json
{
  "events": [
    {
      "id": "...",
      "event_id": "webhook-test-001",
      "event_type": "Subscribe",
      "status": "pending",
      "received_at": "2025-10-27T..."
    }
  ],
  "total": 1
}
```

---

### åœºæ™¯ 5: æµ‹è¯• Landing Page

**ç›®æ ‡**: æµ‹è¯• Marketplace æ¿€æ´»æµç¨?
**æ­¥éª¤**:
1. æ‰“å¼€æµè§ˆå™¨è®¿é—?`http://localhost:5000/landing?token=test-token`
2. æŸ¥çœ‹ Landing Page æ˜¯å¦æ­£ç¡®åŠ è½½
3. æŸ¥çœ‹è®¢é˜…ä¿¡æ¯æ˜¯å¦æ˜¾ç¤º

**é¢„æœŸç»“æœ**:
- âœ?Landing Page æ­£ç¡®åŠ è½½
- âœ?æ˜¾ç¤ºè®¢é˜…ä¿¡æ¯
- âœ?æ˜¾ç¤ºæ¿€æ´»æŒ‰é’?
---

### åœºæ™¯ 6: æµ‹è¯•å‰ç«¯åº”ç”¨

**ç›®æ ‡**: æµ‹è¯•å‰ç«¯åº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œ

**æ­¥éª¤**:
1. æ‰“å¼€æµè§ˆå™¨è®¿é—?`http://localhost:3000`
2. æŸ¥çœ‹åº”ç”¨æ˜¯å¦æ­£ç¡®åŠ è½½
3. ç‚¹å‡» "Azure AD ç™»å½•" æŒ‰é’®
4. éªŒè¯ç™»å½•æµç¨‹

**é¢„æœŸç»“æœ**:
- âœ?å‰ç«¯åº”ç”¨æ­£ç¡®åŠ è½½
- âœ?å¯ä»¥ç‚¹å‡»ç™»å½•æŒ‰é’®
- âœ?ç™»å½•æµç¨‹æ­£å¸¸

---

### åœºæ™¯ 7: æµ‹è¯• API ä»¤ç‰Œ

**ç›®æ ‡**: éªŒè¯ JWT ä»¤ç‰Œè‡ªåŠ¨æ·»åŠ åˆ°è¯·æ±‚å¤´

**æ­¥éª¤**:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…?(F12)
2. åˆ‡æ¢åˆ?"Network" æ ‡ç­¾
3. åœ¨å‰ç«¯åº”ç”¨ä¸­æ‰§è¡Œ API è°ƒç”¨
4. æŸ¥çœ‹è¯·æ±‚å¤´ä¸­æ˜¯å¦åŒ…å« `Authorization: Bearer <token>`

**é¢„æœŸç»“æœ**:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

### åœºæ™¯ 8: æµ‹è¯•æ•°æ®åº“éš”ç¦?
**ç›®æ ‡**: éªŒè¯å¤šç§Ÿæˆ·æ•°æ®éš”ç¦?
**æ­¥éª¤**:
1. è¿æ¥åˆ?PostgreSQL æ•°æ®åº?2. æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢:

```sql
-- æŸ¥çœ‹ç”¨æˆ·è¡?SELECT * FROM users;

-- æŸ¥çœ‹è®¢é˜…è¡?SELECT * FROM subscriptions;

-- æŸ¥çœ‹äº‹ä»¶è¡?SELECT * FROM webhook_events;

-- æŸ¥çœ‹å®¡è®¡æ—¥å¿—
SELECT * FROM audit_logs;
```

3. éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®å­˜å‚¨

**é¢„æœŸç»“æœ**:
- âœ?ç”¨æˆ·è¡¨æœ‰æ•°æ®
- âœ?è®¢é˜…è¡¨æœ‰æ•°æ®
- âœ?äº‹ä»¶è¡¨æœ‰æ•°æ®
- âœ?å®¡è®¡æ—¥å¿—æœ‰è®°å½?
---

## ğŸ“Š æµ‹è¯•æ¸…å•

- [ ] åœºæ™¯ 1: å¥åº·æ£€æŸ?- [ ] åœºæ™¯ 2: Marketplace å¥åº·æ£€æŸ?- [ ] åœºæ™¯ 3: å‘é€?Webhook äº‹ä»¶
- [ ] åœºæ™¯ 4: æŸ¥è¯¢äº‹ä»¶åˆ—è¡¨
- [ ] åœºæ™¯ 5: æµ‹è¯• Landing Page
- [ ] åœºæ™¯ 6: æµ‹è¯•å‰ç«¯åº”ç”¨
- [ ] åœºæ™¯ 7: æµ‹è¯• API ä»¤ç‰Œ
- [ ] åœºæ™¯ 8: æµ‹è¯•æ•°æ®åº“éš”ç¦?
---

## ğŸ” è°ƒè¯•æŠ€å·?
### æŸ¥çœ‹å®æ—¶æ—¥å¿—

**åç«¯æ—¥å¿—**:
```
åœ¨å¯åŠ¨åç«¯æœåŠ¡çš„ç»ˆç«¯ä¸­æŸ¥çœ‹å®æ—¶æ—¥å¿?```

**å‰ç«¯æ—¥å¿—**:
```
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…?(F12) -> Console æ ‡ç­¾
```

### æŸ¥çœ‹æ•°æ®åº?
```bash
# è¿æ¥åˆ?PostgreSQL
psql -U postgres -d mediagenie

# æŸ¥çœ‹è¡?\dt

# æŸ¥çœ‹æ•°æ®
SELECT * FROM users;
SELECT * FROM subscriptions;
SELECT * FROM webhook_events;
```

### æŸ¥çœ‹ API è¯·æ±‚

```bash
# ä½¿ç”¨ curl æµ‹è¯• API
curl http://localhost:9001/health

# ä½¿ç”¨ curl å‘é€?Webhook
curl -X POST http://localhost:9001/marketplace/webhook \
  -H "Content-Type: application/json" \
  -d '{"id": "test-1", ...}'
```

---

## â?å¸¸è§é—®é¢˜

### é—®é¢˜ 1: åç«¯æœåŠ¡æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: `Error loading ASGI app`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ?Python ç‰ˆæœ¬: `python --version`
2. æ£€æŸ¥ä¾èµ? `pip install -r requirements.txt`
3. æ£€æŸ?.env æ–‡ä»¶: `cat .env`
4. æ£€æŸ¥æ•°æ®åº“è¿æ¥: `python test_db_connection.py`

---

### é—®é¢˜ 2: å‰ç«¯åº”ç”¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: `npm start` å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ¸…é™¤ node_modules: `rm -rf node_modules`
2. é‡æ–°å®‰è£…ä¾èµ–: `npm install`
3. å¯åŠ¨åº”ç”¨: `npm start`

---

### é—®é¢˜ 3: Webhook äº‹ä»¶æœªä¿å­?
**ç—‡çŠ¶**: å‘é€?Webhook åï¼ŒæŸ¥è¯¢äº‹ä»¶åˆ—è¡¨ä¸ºç©º

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
2. æ£€æŸ¥åç«¯æ—¥å¿?3. æ£€æŸ?webhook_events è¡¨æ˜¯å¦å­˜åœ?4. æ£€æŸ?RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®

---

## ğŸ“ˆ ä¸‹ä¸€æ­?
### éƒ¨ç½²åˆ?Azure
- é…ç½® Azure App Service
- éƒ¨ç½²å‰åç«¯åº”ç”?- é…ç½®ç¯å¢ƒå˜é‡
- æµ‹è¯•éƒ¨ç½²

### æ€§èƒ½æµ‹è¯•
- æµ‹è¯•é«˜å¹¶å?Webhook å¤„ç†
- æµ‹è¯•å¤§æ•°æ®é‡æŸ¥è¯¢
- æµ‹è¯•æ•°æ®åº“æ€§èƒ½

---

## âœ?æˆåŠŸæ ‡å¿—

âœ?**å½“æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡æ—¶ï¼Œè¯´æ˜ç«¯åˆ°ç«¯æµç¨‹æˆåŠ?*:

1. âœ?æ‰€æœ‰æœåŠ¡éƒ½æ­£å¸¸è¿è¡Œ
2. âœ?å¥åº·æ£€æŸ¥è¿”å›?200 OK
3. âœ?Webhook äº‹ä»¶æ­£ç¡®å¤„ç†
4. âœ?äº‹ä»¶å·²ä¿å­˜åˆ°æ•°æ®åº?5. âœ?Landing Page æ­£ç¡®åŠ è½½
6. âœ?å‰ç«¯åº”ç”¨æ­£å¸¸è¿è¡Œ
7. âœ?API ä»¤ç‰Œè‡ªåŠ¨æ·»åŠ 
8. âœ?æ•°æ®åº“éš”ç¦»æ­£å¸¸å·¥ä½?
---

**å‡†å¤‡å¥½è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•äº†å—ï¼?* ğŸš€

**å‘Šè¯‰æˆ‘ä½ å·²ç»å¯åŠ¨äº†æ‰€æœ‰æœåŠ¡ï¼Œæˆ‘ä¼šæŒ‡å¯¼ä½ å®Œæˆæµ‹è¯•ï¼**

